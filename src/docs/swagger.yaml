openapi: 3.0.0
info:
  title: CarBoy Technician Backend API
  description: API documentation for Technician flow of CarBoy platform
  version: 1.0.0

servers:
  - url: http://localhost:5000/api
    description: Local Development

tags:
  - name: Auth
    description: Technician authentication
  - name: Technician
    description: Technician profile
  - name: Jobs
    description: Technician job lifecycle (accept, travel, inspect)
  - name: Inspection
    description: Checklist & Report

paths:

  /technician/auth/login:
    post:
      tags: [Auth]
      summary: Technician login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: ravi.tech@carboy.com
                password:
                  type: string
                  example: ravi12345
      responses:
        '200':
          description: Login success
        '401':
          description: Invalid credentials

  /technician/me:
    get:
      tags: [Technician]
      summary: Get technician profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile details

  /technician/jobs:
    get:
      tags: [Jobs]
      summary: List jobs assigned to technician
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, accepted, traveling, reached, in_inspection, completed]
          description: Filter jobs by status
      responses:
        '200':
          description: List of jobs

  /technician/jobs/{jobId}:
    get:
      tags: [Jobs]
      summary: Get job details
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job details

  /technician/jobs/{jobId}/accept:
    post:
      tags: [Jobs]
      summary: Accept assigned job
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Job accepted

  /technician/jobs/{jobId}/start-travel:
    post:
      tags: [Jobs]
      summary: Start traveling to inspection location
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status updated to traveling

  /technician/jobs/{jobId}/reached-location:
    post:
      tags: [Jobs]
      summary: Mark that technician reached location
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status updated to reached

  /technician/jobs/{jobId}/start-inspection:
    post:
      tags: [Inspection]
      summary: Start inspection
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Status updated to in_inspection

  /technician/jobs/{jobId}/checklist:
    get:
      tags: [Inspection]
      summary: Get checklist for the job
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Checklist data

  /technician/jobs/{jobId}/checkpoints:
    post:
      tags: [Inspection]
      summary: Submit checklist answer
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                checkpointKey:
                  type: string
                  example: engine_condition
                selectedOption:
                  type: string
                  example: Normal
                notes:
                  type: string
                  example: Everything looks fine.
                photoUrl:
                  type: string
                  example: https://example.com/image.jpg
      responses:
        '200':
          description: Answer saved

  /technician/jobs/{jobId}/complete:
    post:
      tags: [Inspection]
      summary: Complete inspection and submit report
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                summary:
                  type: string
                  example: Vehicle in good condition, minor scratches.
                overallStatus:
                  type: string
                  enum: [PASS, FAIL, ATTENTION]
                recommendations:
                  type: array
                  items:
                    type: object
                    properties:
                      text:
                        type: string
                      severity:
                        type: string
                        enum: [low, medium, high]
      responses:
        '200':
          description: Inspection completed, report submitted

  /technician/jobs/{jobId}/completed-summary:
    get:
      tags: [Inspection]
      summary: View completed inspection summary
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Completed job + report summary


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
